# Безопасность


## Аутентификация и авторизация

В системе существуют следующие роли: 
- кандидат
- сотрудник
- HR
- рекрутер
- администратор.

Роли кандидата и сотрудника на данный момент не имеют доступа в систему и не являются объектом рассмотрения.

Остальные пользователи могут ввести логин (email) и пароль (созданный ими) и, при успехе, аутентифицироваться.
Система на основании данных о пользователе формирует токен (по спецификации PASETO), включающий в себя обязательные поля: время истечения жизни, права доступа к функционалу системы.

### Формат прав доступа

Cтрока вида "data-type:mode;data-type:mode;...", где 
* data-type - тип, запрашиваемых данных: 
    * user - данные о сотруднике, 
    * *** - данные о кандидате (в процессе),
    * ...;
* mode - число, отображающее права доступа к данным: 
    * 1 бит - создание данных,
    * 2 бит - чтение данных,
    * 3 бит - редактирование данных,
    * 4 бит - удаление данных.

Пример строки прав доступа: 
"user:6" - пользователь имеет доступ к чтению и редактированию данных сотрудника (6 = 0110).

### Передача токена 
Токен подписывается приватным ключом и разделяется на две части: header.payload и signature. При успешной аутентификации сервер передает клиенту 
* часть header.payload в SameSite Secure Cookie (доступно только по https и доступно из JS кода) с именем "ecabinet:token",
* часть signature в SameSite Secure HttpOnly Cookie (доступно только по https и не доступно из JS кода) c именем "ecabinet:token:sign".

Этот прием позволит избежать распространенных уязвимостей типа Cross Site Scripting (XSS), Cross Site Request Forgery (CSRF).

### Frontend
* В случае получения от сервера кода ответа 401 требуется отправить запрос по пути /api/v1/login (см. API) и убедиться в возврате кода ответа 200.
* При использовании аутентификации при помощи cookie (вышеописанным) дополнительных действий по подтверждению следующих запросов со стороны frontend не требуется.
* Запрос пользователя на logout реализуется простым удалением cookie "ecabinet:token".
* При необходимости, получая данные из "ecabinet:token", можно узнать права пользователя на совершение тех или иных действий (см. формат прав доступа) и, например, скрывать/деактивировать отдельные визуальные блоки.
