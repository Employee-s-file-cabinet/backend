# Безопасность


## Аутентификация и авторизация

В системе существуют следующие роли: 
- кандидат
- сотрудник
- HR
- рекрутер
- администратор

Роли кандидата и сотрудника на данный момент не имеют доступа в систему и не являются объектом рассмотрения.

Остальные пользователи могут ввести логин (email) и пароль (созданный ими) и, при успехе, аутентифицироваться.

Система, на основании данных о пользователе, формирует токен (по спецификации [PASETO](https://github.com/paseto-standard/paseto-spec)), включающий в себя обязательные поля: время истечения жизни и payload (с необходимой в дальнейшем информацией о пользователе).


### Формат прав доступа

Для организации ролей используется подход доступа к ресурсам REST + RBAC.

Для управления политиками доступа - библиотека [casbin](https://github.com/casbin/casbin).

Настройки политик RBAC:

| sub (роль) | obj (ресурс)              | act (метод HTTP)                                                |
|------------|---------------------------|-----------------------------------------------------------------|
| employee   | /users/{user_id}          | GET (только если user_id равен id запрашивающего данный ресурс) |
| hr         | /users<br/>/users/*       | *                                                               |
| admin      | /accounts<br/>/accounts/* | *                                                               |

Далее пользователи добавляются в соответствующие группы при создании записи о них в БД.

Например:
- когда администратор создаёт аккаунт для HR'а (задав ФИО, почту и пароль), то данному сотруднику присваивается роль `hr` и он получает права совершать определённые действия (создавать, обновлять и т.п.) с определёнными ресурсами (`/users`)
- когда HR создаёт карточку работнику, то данному сотруднику присваивается роль `employee` и он получает право просматривать свои данные


### Передача токена 
Токен подписывается приватным ключом и разделяется на две части: header.payload и signature. При успешной аутентификации сервер передает клиенту 
* часть header.payload в SameSite Secure Cookie (доступно только по https и доступно из JS кода) с именем "ecabinet-token",
* часть signature в SameSite Secure HttpOnly Cookie (доступно только по https и не доступно из JS кода) c именем "ecabinet-token_sign".

Этот приём позволит избежать распространенных уязвимостей типа Cross Site Scripting (XSS), Cross Site Request Forgery (CSRF).


### Frontend
* В случае получения от сервера кода ответа 401 требуется отправить запрос по пути /api/v1/login (см. API) и убедиться в возврате кода ответа 200.
* При использовании аутентификации при помощи cookie (вышеописанным) дополнительных действий по подтверждению следующих запросов со стороны frontend не требуется.
* Запрос пользователя на logout реализуется простым удалением cookie "ecabinet-token".
